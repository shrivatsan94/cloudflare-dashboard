{"ast":null,"code":"var _jsxFileName = \"/Users/shrivatsan/Documents/picanova/cloudflare-explorer/main-app/src/NewCollectiveData.js\",\n  _s = $RefreshSig$();\nimport { useState } from 'react';\nimport React, { Component } from 'react';\nimport { format, parseISO } from \"date-fns\";\nimport moment from 'moment';\nimport { Chart as ChartJS, CategoryScale, LinearScale, BarElement, Title, Tooltip, Legend } from \"chart.js\";\nimport { Bar } from \"react-chartjs-2\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst NewCollectiveData = props => {\n  _s();\n  const startDate = props.startDate;\n  const endDate = props.endDate;\n  const [isLoading, setIsLoading] = useState(false);\n  const [data, setData] = useState({\n    data: []\n  });\n  const [isAlert, setIsAlert] = useState(false);\n  const [alertMessage, setAlertMessage] = useState('');\n  const [afterFetchSite, setAfterFetchSite] = useState('3d.me');\n  const [dataFetch, setDataFetch] = useState(false);\n  const [chartData, setChartData] = useState({});\n  const [site, setSite] = useState('3d.me');\n  const options = {\n    indexAxis: \"x\",\n    elements: {\n      bar: {\n        borderWidth: 2\n      }\n    },\n    responsive: true,\n    plugins: {\n      legend: {\n        position: \"right\"\n      },\n      title: {\n        display: true,\n        text: `Page Views for ${afterFetchSite}`\n      }\n    }\n  };\n  const handleCollectiveClick = async () => {\n    if (startDate.getTime() > endDate.getTime()) {\n      setIsAlert(true);\n      setAlertMessage('Start Date cannot be greater than end date. Please set it accordingly.');\n    } else if ((endDate.getTime() - startDate.getTime()) / 1000 >= 259200) {\n      console.log(endDate.getTime() - startDate.getTime());\n      setIsAlert(true);\n      setAlertMessage('Range cannot be greater than 3 days. Please set it accordingly.');\n    } else {\n      setIsAlert(false);\n      setAlertMessage('');\n      var startMonth = (\"0\" + (new Date(startDate).getMonth() + 1)).slice(-2);\n      var endMonth = (\"0\" + (new Date(endDate).getMonth() + 1)).slice(-2);\n      const mendDate = new Date(endDate).getFullYear().toString() + '-' + startMonth + '-' + (\"0\" + new Date(endDate).getDate()).slice(-2);\n      const mstartDate = new Date(startDate).getFullYear().toString() + '-' + endMonth + '-' + (\"0\" + new Date(startDate).getDate()).slice(-2);\n      await Promise.all(props.websiteList.map(async value => {\n        const PAGEVIEWS_QUERY = `\n             query {\n               viewer {\n                 zones(filter: { zoneTag: \"${value.split(',')[0]}\" }) {\n                   httpRequests1hGroups(\n                     filter: {\n                       date_geq: \"${mstartDate}\",\n             \t\t  date_leq: \"${mendDate}\"\n                     }\n                     limit: 1000\n                     orderBy: [datetime_DESC]\n                   ) {\n                     datetime: dimensions{datetime}\n                     sum {\n                     \tpageViews\n                     }\n                   }\n                 }\n               }\n             }\n             `;\n        const authorisationToken = \"Bearer \" + process.env.REACT_APP_authorisation_token;\n        const authorisationHeaders = {\n          'X-Auth-Email': process.env.REACT_APP_email_id,\n          'Authorization': authorisationToken,\n          'Content-Type': 'text/plain'\n        };\n        const response = await fetch('http://localhost:8080/api.cloudflare.com:443/client/v4/graphql', {\n          method: 'POST',\n          headers: authorisationHeaders,\n          body: JSON.stringify({\n            query: PAGEVIEWS_QUERY\n          })\n        });\n        const result = await response.json();\n        setData(result);\n        setAfterFetchSite(site);\n        setIsLoading(false);\n        const labels = await result.data.viewer.zones[0].httpRequests1hGroups.map(value => value.datetime.datetime);\n        const mydata = {\n          labels: labels,\n          datasets: [{\n            label: \"Page Views\",\n            data: await result.data.viewer.zones[0].httpRequests1hGroups.map(value => value.sum.pageViews),\n            borderColor: \"rgb(255, 99, 132)\",\n            backgroundColor: \"rgba(255, 99, 132, 0.5)\"\n          }]\n        };\n        setChartData(mydata);\n        setDataFetch(true);\n        const styleObject = {\n          \"float\": \"left\",\n          \"margin\": \"auto\",\n          \"height\": \"40%\",\n          \"width\": \"100%\"\n        };\n        const barObject = {\n          \"float\": \"left\",\n          \"margin\": \"auto\",\n          \"width\": \"50%\"\n        };\n        const alertObject = {\n          \"color\": \"red\"\n        };\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleCollectiveClick,\n            children: \"Fetch collective data\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 142,\n            columnNumber: 12\n          }, this), isLoading && /*#__PURE__*/_jsxDEV(\"h2\", {\n            children: \"Loading...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 143,\n            columnNumber: 25\n          }, this), isAlert && /*#__PURE__*/_jsxDEV(\"h3\", {\n            style: alertObject,\n            children: alertMessage\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 144,\n            columnNumber: 23\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: styleObject,\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              style: barObject,\n              children: dataFetch && /*#__PURE__*/_jsxDEV(Bar, {\n                options: options,\n                data: chartData\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 147,\n                columnNumber: 35\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 146,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 145,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 9\n        }, this);\n      }));\n    }\n  };\n};\n_s(NewCollectiveData, \"QkJyASEKrNZr5YZFRhjca98N+8M=\");\n_c = NewCollectiveData;\nexport default NewCollectiveData;\nvar _c;\n$RefreshReg$(_c, \"NewCollectiveData\");","map":{"version":3,"names":["useState","React","Component","format","parseISO","moment","Chart","ChartJS","CategoryScale","LinearScale","BarElement","Title","Tooltip","Legend","Bar","NewCollectiveData","props","startDate","endDate","isLoading","setIsLoading","data","setData","isAlert","setIsAlert","alertMessage","setAlertMessage","afterFetchSite","setAfterFetchSite","dataFetch","setDataFetch","chartData","setChartData","site","setSite","options","indexAxis","elements","bar","borderWidth","responsive","plugins","legend","position","title","display","text","handleCollectiveClick","getTime","console","log","startMonth","Date","getMonth","slice","endMonth","mendDate","getFullYear","toString","getDate","mstartDate","Promise","all","websiteList","map","value","PAGEVIEWS_QUERY","split","authorisationToken","process","env","REACT_APP_authorisation_token","authorisationHeaders","REACT_APP_email_id","response","fetch","method","headers","body","JSON","stringify","query","result","json","labels","viewer","zones","httpRequests1hGroups","datetime","mydata","datasets","label","sum","pageViews","borderColor","backgroundColor","styleObject","barObject","alertObject"],"sources":["/Users/shrivatsan/Documents/picanova/cloudflare-explorer/main-app/src/NewCollectiveData.js"],"sourcesContent":["import {useState} from 'react';\nimport React, { Component }  from 'react';\nimport { format, parseISO } from \"date-fns\"\nimport moment from 'moment';\n\nimport {\n  Chart as ChartJS,\n  CategoryScale,\n  LinearScale,\n  BarElement,\n  Title,\n  Tooltip,\n  Legend\n} from \"chart.js\";\n\nimport { Bar } from \"react-chartjs-2\";\n\nconst NewCollectiveData = (props) => {\n\nconst startDate = props.startDate\nconst endDate = props.endDate\nconst [isLoading, setIsLoading] = useState(false);\nconst [data, setData] = useState({data: []});\nconst [isAlert, setIsAlert] = useState(false)\nconst [alertMessage, setAlertMessage] = useState('')\nconst [afterFetchSite, setAfterFetchSite] = useState('3d.me');\nconst [dataFetch, setDataFetch] = useState(false);\nconst [chartData, setChartData] = useState({});\nconst [site, setSite] = useState('3d.me');\n\nconst options = {\n  indexAxis: \"x\",\n  elements: {\n    bar: {\n      borderWidth: 2\n    }\n  },\n  responsive: true,\n  plugins: {\n    legend: {\n      position: \"right\"\n    },\n    title: {\n      display: true,\n      text: `Page Views for ${afterFetchSite}`\n    }\n  }\n};\n\nconst handleCollectiveClick = async () => {\n            if(startDate.getTime() > endDate.getTime()){\n                setIsAlert(true);\n                setAlertMessage('Start Date cannot be greater than end date. Please set it accordingly.');\n\n            }\n            else if(((endDate.getTime() - startDate.getTime())/(1000)) >= 259200 ){\n                console.log(endDate.getTime() - startDate.getTime())\n                setIsAlert(true);\n                setAlertMessage('Range cannot be greater than 3 days. Please set it accordingly.');\n            }\n            else{\n                setIsAlert(false);\n                setAlertMessage('');\n                var startMonth = (\"0\" + (new Date(startDate).getMonth()  + 1)).slice(-2)\n                var endMonth = (\"0\" + (new Date(endDate).getMonth()  + 1)).slice(-2)\n                const mendDate = new Date(endDate).getFullYear().toString() + '-' + startMonth + '-' + (\"0\" + (new Date(endDate).getDate())).slice(-2)\n                const mstartDate = new Date(startDate).getFullYear().toString() + '-' + endMonth + '-' + (\"0\" + (new Date(startDate).getDate())).slice(-2)\n\n            await Promise.all(props.websiteList.map(async(value) => {\n             const PAGEVIEWS_QUERY = `\n             query {\n               viewer {\n                 zones(filter: { zoneTag: \"${value.split(',')[0]}\" }) {\n                   httpRequests1hGroups(\n                     filter: {\n                       date_geq: \"${mstartDate}\",\n             \t\t  date_leq: \"${mendDate}\"\n                     }\n                     limit: 1000\n                     orderBy: [datetime_DESC]\n                   ) {\n                     datetime: dimensions{datetime}\n                     sum {\n                     \tpageViews\n                     }\n                   }\n                 }\n               }\n             }\n             `;\n\n             const authorisationToken = \"Bearer \" + process.env.REACT_APP_authorisation_token;\n             const authorisationHeaders = {\n                         'X-Auth-Email': process.env.REACT_APP_email_id,\n                         'Authorization': authorisationToken,\n                         'Content-Type': 'text/plain'\n             }\n                   const response = await fetch('http://localhost:8080/api.cloudflare.com:443/client/v4/graphql', {\n                     method: 'POST',\n                     headers: authorisationHeaders,\n                       body: JSON.stringify({ query: PAGEVIEWS_QUERY })\n                   });\n\n            const result = await response.json();\n            setData(result);\n            setAfterFetchSite(site);\n            setIsLoading(false);\n            const labels = await result.data.viewer.zones[0].httpRequests1hGroups.map(value => value.datetime.datetime)\n            const mydata = {\n              labels: labels,\n              datasets: [\n                {\n                  label: \"Page Views\",\n                  data: await result.data.viewer.zones[0].httpRequests1hGroups.map(value => value.sum.pageViews),\n                  borderColor: \"rgb(255, 99, 132)\",\n                  backgroundColor: \"rgba(255, 99, 132, 0.5)\"\n                }\n              ]\n            };\n            setChartData(mydata);\n            setDataFetch(true);\n\n    const styleObject = {\n          \"float\": \"left\",\n          \"margin\": \"auto\",\n          \"height\" : \"40%\",\n          \"width\" : \"100%\"\n    }\n\n    const barObject = {\n          \"float\": \"left\",\n          \"margin\": \"auto\",\n          \"width\": \"50%\"\n    }\n\n    const alertObject = {\n          \"color\": \"red\"\n    }\n\n        return (\n        <div>\n          {<button onClick={handleCollectiveClick}>Fetch collective data</button>}\n          {isLoading && <h2>Loading...</h2>}\n          {isAlert && <h3 style={alertObject}>{alertMessage}</h3>}\n                <div style={styleObject}>\n                  <div style={barObject}>\n                    {dataFetch && <Bar options={options} data={chartData} />}\n                  </div>\n                </div>\n        </div>\n        )\n            }));\n            }\n}\n}\n\nexport default NewCollectiveData;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}